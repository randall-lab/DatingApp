@page "/profiles"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.EntityFrameworkCore
@using DatingApp.Domain
@using DatingApp.Data
@implements IAsyncDisposable
@inject IDbContextFactory<DatingApp.Data.DatingAppContext> DbFactory

@attribute [Authorize(Roles = "Administrator")]

<PageTitle>Profiles</PageTitle>

@* CHANGED: Added 'welcome-title' class for brand consistency *@
<h1 class="welcome-title">Profile Directory</h1>
<hr />

@* CHANGED: Replaced QuickGrid with a flex container for cards *@
<div class="profiles-container">
    @if (context == null)
    {
        <p><em>Loading...</em></p>
    }
    else
    {
        @foreach (var profile in context.Profile)
        {
            <div class="profile-card">
                <div class="profile-main">
                    @* Photo Section *@
                    <div class="photo-wrapper">
                        @if (!string.IsNullOrEmpty(profile.PhotoURL))
                        {
                            <img src="@profile.PhotoURL" alt="Profile Photo" class="profile-img-circle" />
                        }
                        else
                        {
                            <div class="profile-img-circle no-photo">No Photo</div>
                        }
                    </div>

                    @* Details Section *@
                    <div class="profile-info">
                        <h2 class="profile-name">@profile.FirstName @profile.LastName</h2>
                        <p class="profile-meta">
                            <strong>Age:</strong> @profile.Age | <strong>Gender:</strong> @profile.Gender
                        </p>
                        <p class="profile-region"><strong>Region:</strong> @profile.RegionName</p>
                        <p class="profile-bio"><strong>Bio:</strong> @profile.Bio</p>
                        <p class="profile-interest"><strong>Interest:</strong> @profile.Interest</p>
                        <p class="last-active">Last Active: @profile.LastActiveDate.ToShortDateString()</p>
                    </div>
                </div>

                @* Admin Actions *@
                <div class="profile-actions">
                    <a href="@($"profiles/details?id={profile.ProfileId}")" class="btn-action details">Details</a>
                    <a href="@($"profiles/edit?id={profile.ProfileId}")" class="btn-action edit">Edit</a>
                    <a href="@($"profiles/delete?id={profile.ProfileId}")" class="btn-action delete">Delete</a>
                </div>
            </div>
        }
    }
</div>

@code {
    private DatingAppContext context = default!;

    protected override void OnInitialized()
    {
        context = DbFactory.CreateDbContext();
    }

    public async ValueTask DisposeAsync()
    {
        await context.DisposeAsync();
    }
}